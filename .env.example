########################
# Whisper модель
########################

# Имя модели faster-whisper (large-v3 — максимальное качество, самая тяжёлая)
WHISPER_MODEL=large-v3

# Ширина бима: больше = качественнее и медленнее, меньше = быстрее и глупее
WHISPER_BEAM_SIZE=5

# Для stoch. режимов, тут по факту почти не влияет, но пусть будет согласовано с beam_size
WHISPER_BEST_OF=5

# Температура: 0.0 = минимум галлюцинаций, чем выше — тем больше модель «фантазирует»
WHISPER_TEMPERATURE=0.0


########################
# Чанкование (длины файлов)
########################

# Включать ли вообще механику разбиения длинных файлов
ENABLE_CHUNKING=true

# Если длительность файла < этого порога (сек) — обрабатываем целиком без чанков
# Увеличишь — меньше чанков, больше риск галлюцинаций на очень длинных файлах
# обязательно изменить VAD_MAX_CHUNK_SEC
MAX_DURATION_SHORT_SEC=300      # 5 минут

# Целевая длина одного чанка (сек). Больше — меньше чанков, но тяжелее и потенциально глючнее.
MAX_CHUNK_DURATION=300          # 5 минут

# Перекрытие между чанками (сек). Чем больше, тем лучше стыки, но больше работы.
OVERLAP_SECONDS=15              # 15 секунд


########################
# VAD / нарезка по речи
########################

# Использовать ли Silero VAD при нарезке. Если false — режем тупо по времени.
VAD_ENABLED=true

# Максимальная длина чанка при VAD (сек). Обычно = MAX_CHUNK_DURATION.
VAD_MAX_CHUNK_SEC=300

# Минимальная длительность речи, чтобы считать её отдельным кусочком (сек).
# Если сделать меньше — VAD начнёт ловить короткие шумы, и чанков станет слишком много.
VAD_MIN_SPEECH_SEC=1.0

# Минимальная тишина между фрагментами речи (сек).
# Больше — склеивает больше фраз в один интервал, меньше — дробит чаще.
VAD_MIN_SILENCE_SEC=0.5


########################
# Антигаллюцинатор: уверенность и повторы
########################

# Минимальный средний prob по словам для сегмента. Ниже — считаем, что модель не уверена.
# Повышая порог, ты будешь отбрасывать больше сомнительных сегментов.
MIN_WORD_CONFIDENCE=0.6

# Окно по времени (сек) для поиска повторов между сегментами.
# Больше окно — агрессивнее режутся «закольцованные» куски по всей минуте речи.
MAX_REPEAT_WINDOW_SEC=90

# Порог похожести текста сегментов (Jaccard по токенам).
# 0.9 = почти совпадает, ниже — допускаем больше вариативности.
REPEAT_SIMILARITY_THRESHOLD=0.92

# Внутрисегментные повторы:
# размер n-граммы (по словам). 3–4 обычно достаточно, чтобы поймать зацикленные фразы.
INTRA_REPEAT_NGRAM=3

# Если доля повторяющихся n-грамм внутри сегмента > этого порога — сегмент считаем мусором.
# Повышая порог, даёшь больше шансов длинным повторяющимся фразам.
INTRA_REPEAT_MAX_RATIO=0.6


########################
# Лимиты и параллелизм
########################

# Максимальный размер входного файла (в мегабайтах). Защита от заливки многогигабайтного трэша.
MAX_FILE_SIZE_MB=3000           # 3 GB

# Сколько транскрибаций можно тянуть параллельно в одном инстансе.
# Больше — сильнее грузит GPU/CPU, меньше — безопаснее по ресурсам.
MAX_CONCURRENT=2


########################
# Диаризация (опционально)
########################

# HF токен нужен только если включаешь диаризацию (pyannote).
HF_TOKEN=

# Включать ли диаризацию по умолчанию, если клиент не просит явно.
DIARIZE_BY_DEFAULT=false


########################
# Очистка файлов
########################

# Через сколько часов удалять старые uploads/results.
CLEANUP_HOURS=24